
# API Referral System

Проект API для реферальной системы с использованием Go и PostgreSQL. Проект разворачивается в контейнерах с помощью Docker Compose.

## Описание структуры проекта

- **Docker Compose** — конфигурация, содержащая сервисы приложения и базы данных.
- **wait-for-postgres.sh** — скрипт для ожидания готовности базы данных перед запуском приложения.
- **Makefile** — включает команды для управления миграциями и запуска приложения.

## Структура

- **services/postgres** — контейнер для базы данных PostgreSQL, где:
  - Имя пользователя, пароль и база данных берутся из `.env` файла.
- **services/app** — контейнер для Go-приложения, с командой для ожидания PostgreSQL перед запуском.

## Требования

- Docker и Docker Compose
- Make

## Установка и запуск

1. Склонируйте репозиторий и перейдите в директорию проекта:
   ```bash
   git clone git@github.com:Oleg-React-Dev/referral_system.git
   cd referral_system
   ```

2. Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```
   Внесите изменения в соответствии с вашими переменными окружения.

3. Запустите контейнеры с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```

4. **Swagger UI**: После успешного запуска Swagger будет доступен по адресу:
   ```
   http://localhost:8080/swagger/index.html
   ```

## Makefile Команды

- **Сборка и запуск приложения**:
  ```bash
  make run
  ```
- **Миграции**:
  - Применить миграции:
    ```bash
    make migrate_up
    ```
  - Откатить миграции:
    ```bash
    make migrate_down
    ```

## wait-for-postgres.sh

Скрипт `wait-for-postgres.sh` помогает убедиться, что контейнер PostgreSQL готов перед запуском приложения Go. Скрипт использует `psql` для проверки доступности базы данных.

## Подключение к базе данных

Используйте следующую команду для подключения к базе данных PostgreSQL из контейнера приложения:
```bash
docker-compose exec postgres psql -U <имя пользователя> -d <имя базы данных>
```

## Используемые технологии

- **Go**: для создания API-сервиса
- **PostgreSQL**: база данных
- **Swagger**: для документации API

## Примечания

- Все команды запуска приложения и миграций находятся в `Makefile`.
- Ожидание готовности базы данных обеспечивается скриптом `wait-for-postgres.sh`, чтобы избежать ошибок при запуске приложения.
